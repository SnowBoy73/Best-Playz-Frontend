(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{ErIi:function(e,t,n){"use strict";n.r(t),n.d(t,"CommentModule",function(){return A});var c=n("ofXK"),o=n("tyNb"),s=n("mrSG"),i=n("3Pt+"),r=n("XNiG"),l=n("IzEk"),m=n("1G5W"),a=n("AcyG");let b=(()=>{class e{}return e.type="[Comment] Listen For Clients",e})(),d=(()=>{class e{}return e.type="[Comment] Stop Listening For Clients",e})(),u=(()=>{class e{constructor(e){this.clients=e}}return e.type="[Comment] Update Clients",e})(),h=(()=>{class e{}return e.type="[Comment] Listen For Comments",e})(),g=(()=>{class e{constructor(e){this.comments=e}}return e.type="[Comment] Update Comments",e})();var p=n("fXoL"),f=n("lJxs"),v=n("7JkF");let C=(()=>{class e{constructor(e){this.socket=e}postComment(e){this.socket.emit("postComment",e)}listenForNewComment(){return this.socket.fromEvent("newComment")}requestHighscoreComments(e){console.log("requestHighscoreComments called"),this.socket.emit("requestHighscoreComments",e)}listenForHighscoreComments(){return this.socket.fromEvent("highscoreComments")}listenForClients(){return this.socket.fromEvent("clients")}listenForErrors(){return this.socket.fromEvent("error")}listenForConnect(){return this.socket.fromEvent("connect").pipe(Object(f.a)(()=>this.socket.ioSocket.id))}listenForDisconnect(){return this.socket.fromEvent("disconnect").pipe(Object(f.a)(()=>this.socket.ioSocket.id))}sendLogin(e){console.log(e.nickname),this.socket.emit("login",e)}disconnect(){console.log("service Disconnect called"),this.socket.disconnect()}connect(){console.log("service Connect called"),this.socket.connect()}}return e.\u0275fac=function(t){return new(t||e)(p.Xb(v.a))},e.\u0275prov=p.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),S=(()=>{let e=class{constructor(e){this.commentService=e}static clients(e){return e.clients}static comments(e){return e.comments}getClients(e){this.clientsUnsub=this.commentService.listenForClients().subscribe(t=>{e.dispatch(new u(t))})}stopListeningForClients(e){this.clientsUnsub&&this.clientsUnsub.unsubscribe()}updateClients(e,t){this.commentService.listenForClients().subscribe(n=>{const c=e.getState(),o=Object.assign(Object.assign({},c),{clients:t.clients});e.setState(o)})}getHighcoreComments(e){this.commentService.listenForHighscoreComments().subscribe(t=>{e.dispatch(new g(t))})}updateHighcoreComments(e,t){this.commentService.listenForHighscoreComments().subscribe(n=>{const c=e.getState(),o=Object.assign(Object.assign({},c),{comments:t.comments});e.setState(o)})}};return e.\u0275fac=function(t){return new(t||e)(p.Xb(C))},e.\u0275prov=p.Kb({token:e,factory:e.\u0275fac}),Object(s.c)([Object(a.a)(b)],e.prototype,"getClients",null),Object(s.c)([Object(a.a)(d)],e.prototype,"stopListeningForClients",null),Object(s.c)([Object(a.a)(u)],e.prototype,"updateClients",null),Object(s.c)([Object(a.a)(h)],e.prototype,"getHighcoreComments",null),Object(s.c)([Object(a.a)(g)],e.prototype,"updateHighcoreComments",null),Object(s.c)([Object(a.e)()],e,"clients",null),Object(s.c)([Object(a.e)()],e,"comments",null),e=Object(s.c)([Object(a.f)({name:"comment",defaults:{clients:[],client:void 0,comments:[]}})],e),e})();var x=n("DTUA"),y=n("XiUz"),T=n("Wp6s"),O=n("f0Cb"),k=n("MutI"),F=n("FKr1"),w=n("NFeN"),H=n("kmnG"),I=n("qFsG"),E=n("bTqV");function j(e,t){1&e&&(p.Tb(0,"div"),p.Tb(1,"h3",11),p.sc(2,"No Highscore selected"),p.Sb(),p.Sb())}function L(e,t){if(1&e&&(p.Tb(0,"div"),p.Tb(1,"span",12),p.sc(2,"Game: "),p.Sb(),p.Pb(3,"h1"),p.Tb(4,"div",13),p.sc(5),p.Sb(),p.Pb(6,"h1"),p.Tb(7,"span",12),p.sc(8," Score: "),p.Sb(),p.Tb(9,"span",14),p.sc(10),p.Sb(),p.Tb(11,"span",15),p.sc(12," Time: "),p.Sb(),p.Tb(13,"span",14),p.sc(14),p.Sb(),p.Tb(15,"div",16),p.sc(16,"by"),p.Sb(),p.Tb(17,"span",17),p.sc(18),p.Sb(),p.Tb(19,"div",18),p.sc(20),p.Sb(),p.Sb()),2&e){const e=p.dc();p.Eb(5),p.tc(e.selectedHighscore.gameId),p.Eb(5),p.tc(e.selectedHighscore.score),p.Eb(4),p.tc(e.selectedHighscore.time),p.Eb(4),p.tc(e.selectedHighscore.nickname),p.Eb(2),p.uc("on ",e.selectedHighscore.date,"")}}function P(e,t){if(1&e&&(p.Tb(0,"mat-list-item"),p.Tb(1,"mat-icon",20),p.sc(2,"face"),p.Sb(),p.sc(3),p.Sb()),2&e){const e=t.$implicit;p.Eb(3),p.uc(" ",e.nickname," ")}}function M(e,t){if(1&e&&(p.Tb(0,"div"),p.Tb(1,"h3",19),p.sc(2,"Online Users: "),p.Sb(),p.Tb(3,"mat-list",7),p.rc(4,P,4,1,"mat-list-item",8),p.Sb(),p.Sb()),2&e){const e=t.ngIf;p.Eb(4),p.ic("ngForOf",e)}}function N(e,t){if(1&e&&(p.Tb(0,"h2"),p.sc(1),p.Sb()),2&e){const e=p.dc();p.Eb(1),p.vc("Comments on ",e.selectedHighscore.nickname,"'s score of ",e.selectedHighscore.score,"")}}function $(e,t){if(1&e&&(p.Tb(0,"mat-list-item"),p.Tb(1,"mat-icon",20),p.sc(2,"create"),p.Sb(),p.Tb(3,"div",21),p.sc(4),p.Sb(),p.Tb(5,"div",22),p.sc(6),p.Sb(),p.Pb(7,"mat-divider"),p.Sb()),2&e){const e=t.$implicit;p.Eb(4),p.tc(null==e?null:e.text),p.Eb(2),p.vc("",null==e?null:e.sender," - ",null==e?null:e.posted,"")}}function z(e,t){if(1&e){const e=p.Ub();p.Tb(0,"div"),p.Tb(1,"mat-form-field",23),p.Tb(2,"mat-label"),p.sc(3,"Write Comment"),p.Sb(),p.Pb(4,"input",24),p.Tb(5,"button",25),p.bc("click",function(){return p.nc(e),p.dc().postComment()}),p.Tb(6,"mat-icon"),p.sc(7,"send"),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&e){const e=p.dc();p.Eb(4),p.ic("formControl",e.commentFC)}}function U(e,t){1&e&&(p.Tb(0,"div",26),p.sc(1," You need to log in to post a comment "),p.Sb())}function _(e,t){if(1&e&&(p.Tb(0,"div",26),p.sc(1),p.Sb()),2&e){const e=t.ngIf;p.Eb(1),p.uc(" ",e," ")}}function q(e,t){if(1&e&&(p.Tb(0,"div",26),p.sc(1),p.Sb()),2&e){const e=p.dc();p.Eb(1),p.uc(" connecting... ",e.userNickname," ")}}const G=[{path:"",component:(()=>{class e{constructor(e,t,n){this.store=e,this.commentService=t,this.storageService=n,this.commentFC=new i.b(""),this.comments=[],this.unsubscribe$=new r.a,this.loginFC=new i.b(""),this.isLoggedIn=localStorage.length}ngOnInit(){var e,t,n;console.log("Comment Component Initialised"),console.log("Logged in as: ",null===(e=this.storageService.loadClient())||void 0===e?void 0:e.nickname),this.commentService.connect(),this.userNickname=null===(t=this.storageService.loadClient())||void 0===t?void 0:t.nickname,console.log("comment userNickname: ",null===(n=this.storageService.loadClient())||void 0===n?void 0:n.nickname),this.selectedHighscore=history.state.data,console.log("selectedHighscore!! = ",this.selectedHighscore),this.commentService.requestHighscoreComments(this.selectedHighscore),this.commentService.listenForHighscoreComments().pipe(Object(l.a)(1)).subscribe(e=>{console.log(e),console.log(e.length," comments received"),this.comments=e}),this.error$=this.commentService.listenForErrors(),this.store.dispatch(new b),this.store.dispatch(new h),this.commentService.listenForNewComment().pipe(Object(m.a)(this.unsubscribe$)).subscribe(e=>{console.log("comment received"),this.selectedHighscore&&(console.log("New comment = ",e),console.log("selectedHighscore  = ",this.selectedHighscore),e.highscoreId===this.selectedHighscore.id&&(console.log("equal  = true"),this.comments.push(e)))}),this.commentService.listenForConnect().pipe(Object(m.a)(this.unsubscribe$)).subscribe(e=>{console.log("connect id",e),this.socketId=e}),this.commentService.listenForDisconnect().pipe(Object(m.a)(this.unsubscribe$)).subscribe(e=>{console.log("disconnect id",e),this.socketId=e})}ngOnDestroy(){console.log("CommentModel Component Destroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),this.commentService.disconnect(),this.store.dispatch(new d)}postComment(){var e,t,n,c;if(console.log("dto nickname: ",null===(e=this.storageService.loadClient())||void 0===e?void 0:e.nickname),(null===(t=this.storageService.loadClient())||void 0===t?void 0:t.nickname)&&this.commentFC.value&&this.selectedHighscore){const e={highscoreId:null===(n=this.selectedHighscore)||void 0===n?void 0:n.id,text:this.commentFC.value,sender:null===(c=this.storageService.loadClient())||void 0===c?void 0:c.nickname};console.log("highscoreId:",e.highscoreId),this.commentService.postComment(e),this.commentFC.patchValue("")}}}return e.\u0275fac=function(t){return new(t||e)(p.Ob(a.g),p.Ob(C),p.Ob(x.a))},e.\u0275cmp=p.Ib({type:e,selectors:[["app-comment"]],decls:26,vars:13,consts:[["fxLayout","row","fxFlex",""],["fxLayout","column","fxFlex","30",1,"mat-card-margin"],["fxFlex",""],[4,"ngIf"],["fxLayout","column","fxFlex","70"],["fxFlex","","fxLayout","column",1,"mat-card-margin"],["fxFlex","","fxLayout","column"],["fxFlex","",1,"scrollable-mat-list"],[4,"ngFor","ngForOf"],["class","warn-text-colour","style","font-family: cursive","style","font-size: 14px",4,"ngIf"],["fxFlex","30px",2,"padding-left","30px"],[1,"warn-text-colour"],["mat-line","",1,"typewriter-text-sm-1"],["mat-line","",1,"gameId-text"],[1,"score-text"],["mat-line","",1,"typewriter-text-sm-1",2,"padding-left","20px"],["mat-line","",1,"player-text",2,"font-size","12px"],["mat-line","",1,"player-text"],["mat-line","",1,"time-text"],[2,"padding-top","20px"],["mat-list-icon",""],["mat-line","",1,"comment-text"],["mat-line","",1,"comment-sender-text",2,"font-size","x-small"],["fxFlex","40",1,"primary-text-colour"],["matInput","","type","text",3,"formControl"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"warn-text-colour",2,"font-size","14px"]],template:function(e,t){1&e&&(p.Tb(0,"div",0),p.Tb(1,"div",1),p.Tb(2,"mat-card",2),p.Tb(3,"mat-card-header"),p.rc(4,j,3,0,"div",3),p.rc(5,L,21,5,"div",3),p.Sb(),p.Tb(6,"mat-card-content"),p.Pb(7,"h1"),p.Pb(8,"mat-divider"),p.Pb(9,"h1"),p.rc(10,M,5,1,"div",3),p.ec(11,"async"),p.Sb(),p.Sb(),p.Sb(),p.Tb(12,"div",4),p.Tb(13,"mat-card",5),p.Tb(14,"mat-card-header"),p.rc(15,N,2,2,"h2",3),p.Sb(),p.Tb(16,"mat-card-content",6),p.Tb(17,"mat-list",7),p.rc(18,$,8,3,"mat-list-item",8),p.Sb(),p.Sb(),p.Tb(19,"mat-card-actions"),p.rc(20,z,8,1,"div",3),p.rc(21,U,2,0,"div",9),p.Sb(),p.Tb(22,"mat-card-footer",10),p.rc(23,_,2,1,"div",9),p.ec(24,"async"),p.rc(25,q,2,1,"div",9),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&e&&(p.Eb(4),p.ic("ngIf",!t.selectedHighscore),p.Eb(1),p.ic("ngIf",t.selectedHighscore),p.Eb(5),p.ic("ngIf",p.fc(11,9,t.clients$)),p.Eb(5),p.ic("ngIf",t.selectedHighscore),p.Eb(3),p.ic("ngForOf",t.comments),p.Eb(2),p.ic("ngIf",t.isLoggedIn),p.Eb(1),p.ic("ngIf",!t.isLoggedIn),p.Eb(2),p.ic("ngIf",p.fc(24,11,t.error$)),p.Eb(2),p.ic("ngIf",!t.socketId))},directives:[y.c,y.a,T.a,T.e,c.k,T.c,O.a,k.a,c.j,T.b,T.d,F.d,k.c,w.a,k.b,H.b,H.e,I.a,i.a,i.h,i.c,E.a,H.f],pipes:[c.b],styles:['.scrollable-mat-list[_ngcontent-%COMP%]{overflow:auto}.gameId-text[_ngcontent-%COMP%]{color:#2f4f4f;font-size:28px;font-family:fantasy;padding-bottom:20px}.typewriter-text-sm-1[_ngcontent-%COMP%]{text-align:center;color:#2e8b57;font-size:18px;font-family:American Typewriter}.score-text[_ngcontent-%COMP%]{text-align:center;color:#006400;font-size:32px;font-family:"sans-serif";padding-bottom:10px}.player-text[_ngcontent-%COMP%]{color:#b22222;font-size:40px;padding:12px}.player-text[_ngcontent-%COMP%], .time-text[_ngcontent-%COMP%]{font-family:American Typewriter;text-align:center}.time-text[_ngcontent-%COMP%]{color:peru;font-size:18px;padding-top:12px}.mat-card-margin[_ngcontent-%COMP%]{margin:10px}']}),Object(s.c)([Object(a.d)(S.clients)],e.prototype,"clients$",void 0),e})()}];let D=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.Mb({type:e}),e.\u0275inj=p.Lb({imports:[[o.c.forChild(G)],o.c]}),e})();var X=n("PCNd");let A=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.Mb({type:e}),e.\u0275inj=p.Lb({imports:[[c.c,D,i.k,X.a,a.c.forFeature([S])]]}),e})()}}]);